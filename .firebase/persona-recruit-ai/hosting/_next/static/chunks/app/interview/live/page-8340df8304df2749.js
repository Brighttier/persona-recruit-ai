(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8137],{68612:(e,t,s)=>{Promise.resolve().then(s.bind(s,96200))},96200:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>A});var i=s(95155),a=s(12115),n=s(35695),r=s(30285),o=s(66695),c=s(26126),l=s(66424),d=s(22346),h=s(55365),u=s(87358);class m{async initializeSession(e){try{let t=await fetch("https://api.elevenlabs.io/v1/convai/conversation",{method:"POST",headers:{Authorization:"Bearer ".concat(this.config.apiKey),"Content-Type":"application/json"},body:JSON.stringify({agent_id:this.config.agentId,context:{candidate_name:e.candidateName,position:e.position,company:e.company,job_description:e.jobDescription,interview_type:"technical_behavioral",instructions:"You are conducting an AI interview for ".concat(e.candidateName," applying for ").concat(e.position," at ").concat(e.company,". Be professional, friendly, and ask relevant questions about their experience, skills, and fit for the role. Keep responses conversational and engaging.")}})});if(!t.ok)throw Error("Failed to create conversation: ".concat(t.statusText));let s=await t.json();return this.session={sessionId:s.conversation_id,agentId:this.config.agentId,isActive:!0,startTime:new Date},this.session}catch(e){throw console.error("ElevenLabs session initialization error:",e),Error("Failed to initialize AI interview session")}}async startConversation(){if(!this.session)throw Error("Session not initialized");try{await this.setupAudioCapture();let e="wss://api.elevenlabs.io/v1/convai/conversation/".concat(this.session.sessionId,"/ws");this.ws=new WebSocket(e),this.ws.onopen=()=>{this.updateState({isConnected:!0,isListening:!1,isSpeaking:!1}),this.startListening()},this.ws.onmessage=e=>{this.handleWebSocketMessage(e)},this.ws.onclose=()=>{this.updateState({isConnected:!1,isListening:!1,isSpeaking:!1})},this.ws.onerror=e=>{console.error("WebSocket error:",e),this.updateState({isConnected:!1,isListening:!1,isSpeaking:!1,error:"Connection error"})}}catch(e){throw console.error("Conversation start error:",e),Error("Failed to start conversation")}}async setupAudioCapture(){try{this.audioContext=new AudioContext({sampleRate:16e3});let e=await navigator.mediaDevices.getUserMedia({audio:{channelCount:1,sampleRate:16e3,echoCancellation:!0,noiseSuppression:!0}});this.mediaRecorder=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:16e3}),this.mediaRecorder.ondataavailable=e=>{var t;e.data.size>0&&(null==(t=this.ws)?void 0:t.readyState)===WebSocket.OPEN&&this.sendAudioChunk(e.data)}}catch(e){throw console.error("Audio capture setup error:",e),Error("Failed to setup audio capture")}}startListening(){this.mediaRecorder&&"inactive"===this.mediaRecorder.state&&(this.audioChunks=[],this.mediaRecorder.start(100),this.updateState({isListening:!0,isSpeaking:!1}))}stopListening(){this.mediaRecorder&&"recording"===this.mediaRecorder.state&&(this.mediaRecorder.stop(),this.updateState({isListening:!1}))}async sendAudioChunk(e){try{var t;let s=await e.arrayBuffer(),i=new Uint8Array(s);(null==(t=this.ws)?void 0:t.readyState)===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"audio_chunk",data:Array.from(i)}))}catch(e){console.error("Audio send error:",e)}}handleWebSocketMessage(e){try{let t=JSON.parse(e.data);switch(t.type){case"agent_response":this.handleAgentResponse(t);break;case"transcription":this.handleTranscription(t);break;case"audio_chunk":this.playAudioChunk(t.data);break;case"conversation_started":this.updateState({isConnected:!0});break;case"agent_speaking_started":this.updateState({isSpeaking:!0,isListening:!1});break;case"agent_speaking_ended":this.updateState({isSpeaking:!1}),this.startListening();break;case"error":this.updateState({error:t.message})}}catch(e){console.error("Message handling error:",e)}}handleAgentResponse(e){let t={id:"ai_".concat(Date.now()),speaker:"ai",text:e.text,timestamp:new Date,audioUrl:e.audio_url,confidence:1};this.notifyMessageHandlers(t)}handleTranscription(e){let t={id:"user_".concat(Date.now()),speaker:"user",text:e.text,timestamp:new Date,confidence:e.confidence};this.notifyMessageHandlers(t)}async playAudioChunk(e){try{if(!this.audioContext)return;let t=this.audioContext.createBuffer(1,e.length,16e3),s=t.getChannelData(0);for(let t=0;t<e.length;t++)s[t]=e[t]/32768;let i=this.audioContext.createBufferSource();i.buffer=t,i.connect(this.audioContext.destination),i.start()}catch(e){console.error("Audio playback error:",e)}}async endConversation(){try{this.stopListening(),this.ws&&(this.ws.close(),this.ws=null),this.session&&(await fetch("https://api.elevenlabs.io/v1/convai/conversation/".concat(this.session.sessionId),{method:"DELETE",headers:{Authorization:"Bearer ".concat(this.config.apiKey)}}),this.session.endTime=new Date,this.session.isActive=!1),this.audioContext&&(await this.audioContext.close(),this.audioContext=null),this.updateState({isConnected:!1,isListening:!1,isSpeaking:!1})}catch(e){console.error("End conversation error:",e)}}async getConversationTranscript(){if(!this.session)throw Error("No active session");try{let e=await fetch("https://api.elevenlabs.io/v1/convai/conversation/".concat(this.session.sessionId,"/transcript"),{headers:{Authorization:"Bearer ".concat(this.config.apiKey)}});if(!e.ok)throw Error("Failed to fetch transcript");return(await e.json()).messages.map(e=>({id:e.id,speaker:"agent"===e.speaker?"ai":"user",text:e.text,timestamp:new Date(e.timestamp),confidence:e.confidence}))}catch(e){throw console.error("Transcript fetch error:",e),Error("Failed to get conversation transcript")}}onMessage(e){this.messageHandlers.push(e)}onStateChange(e){this.stateHandlers.push(e)}notifyMessageHandlers(e){this.messageHandlers.forEach(t=>t(e))}updateState(e){let t={isConnected:!1,isListening:!1,isSpeaking:!1,...e};this.stateHandlers.forEach(e=>e(t))}getCurrentSession(){return this.session}constructor(e){this.ws=null,this.session=null,this.messageHandlers=[],this.stateHandlers=[],this.audioContext=null,this.mediaRecorder=null,this.audioChunks=[],this.config=e}}let g=()=>({apiKey:u.env.ELEVENLABS_API_KEY||"demo-key",agentId:u.env.ELEVENLABS_AGENT_ID||"demo-agent",voiceId:u.env.ELEVENLABS_VOICE_ID||"default-voice",model:"eleven_turbo_v2"});class p{async initializeSession(e){return{sessionId:"demo_".concat(Date.now()),agentId:"demo-agent",isActive:!0,startTime:new Date}}async startConversation(){this.isActive=!0,this.updateState({isConnected:!0,isListening:!1,isSpeaking:!1}),setTimeout(()=>{let e={id:"ai_".concat(Date.now()),speaker:"ai",text:"Hello! I'm your AI interviewer. This is a demo mode since ElevenLabs is not fully configured. I'll guide you through some questions about your experience and qualifications. Shall we begin?",timestamp:new Date,confidence:1};this.notifyMessageHandlers(e),this.updateState({isConnected:!0,isListening:!0,isSpeaking:!1})},1e3)}async endConversation(){this.isActive=!1,this.updateState({isConnected:!1,isListening:!1,isSpeaking:!1})}onMessage(e){this.messageHandlers.push(e)}onStateChange(e){this.stateHandlers.push(e)}notifyMessageHandlers(e){this.messageHandlers.forEach(t=>t(e))}updateState(e){let t={isConnected:!1,isListening:!1,isSpeaking:!1,...e};this.stateHandlers.forEach(e=>e(t))}getCurrentSession(){return this.isActive?{sessionId:"demo-session",agentId:"demo-agent",isActive:!0,startTime:new Date}:null}constructor(){this.messageHandlers=[],this.stateHandlers=[],this.isActive=!1}}var x=s(50172),v=s(45554),f=s(37648),b=s(70154),w=s(43152),y=s(7149),j=s(6273),N=s(16021),S=s(45481),k=s(31554),C=s(38224);function E(){let e=(0,n.useSearchParams)(),t=(0,a.useRef)(null),s=(0,a.useRef)(null),u=(0,a.useRef)(null),E=(0,a.useRef)(null),A=e.get("id")||"demo-interview-001",I=e.get("candidate")||"John Doe",L=e.get("position")||"Senior Software Engineer",R=e.get("company")||"TechCorp Inc.",[_,T]=(0,a.useState)({isRecording:!1,isConnected:!1,isMuted:!1,isVideoEnabled:!0,duration:0,aiSpeaking:!1,aiListening:!1}),[M,D]=(0,a.useState)([]),[z,H]=(0,a.useState)(""),[B,V]=(0,a.useState)(!0),[O,F]=(0,a.useState)("");(0,a.useEffect)(()=>{let e;return _.isRecording&&(e=setInterval(()=>{T(e=>({...e,duration:e.duration+1}))},1e3)),()=>clearInterval(e)},[_.isRecording]);let P=(0,a.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:{echoCancellation:!0,noiseSuppression:!0}});u.current=e,t.current&&(t.current.srcObject=e),s.current=new MediaRecorder(e,{mimeType:"video/webm;codecs=vp8,opus"}),T(e=>({...e,isConnected:!0})),V(!1)}catch(e){console.error("Media initialization error:",e),F("Failed to access camera or microphone. Please check your permissions."),V(!1)}},[]),K=(0,a.useCallback)(async()=>{try{let e=g();"demo-key"!==e.apiKey&&"demo-agent"!==e.agentId?E.current=new m(e):(console.log("Using demo conversation service - ElevenLabs not configured"),E.current=new p),E.current.onMessage(e=>{D(t=>[...t,e]),"ai"===e.speaker&&H(e.text)}),E.current.onStateChange(e=>{T(t=>({...t,isConnected:e.isConnected,aiSpeaking:e.isSpeaking,aiListening:e.isListening})),e.error&&F(e.error)}),await E.current.initializeSession({candidateName:I,position:L,company:R,jobDescription:"Interview for ".concat(L," position at ").concat(R)}),await E.current.startConversation()}catch(e){console.error("ElevenLabs initialization error:",e),F("Using demo mode - could not connect to ElevenLabs. Check configuration."),E.current=new p,await E.current.initializeSession({candidateName:I,position:L,company:R}),await E.current.startConversation()}},[I,L,R]),W=(0,a.useCallback)(async()=>{if(!s.current||!u.current)return void F("Media not initialized");try{let e=[];s.current.ondataavailable=t=>{t.data.size>0&&e.push(t.data)},s.current.onstop=()=>{let t=new Blob(e,{type:"video/webm"});console.log("Interview recording completed:",t)},s.current.start(1e3),T(e=>({...e,isRecording:!0})),await K()}catch(e){console.error("Start interview error:",e),F("Failed to start interview recording.")}},[K]),U=(0,a.useCallback)(async()=>{try{s.current&&_.isRecording&&s.current.stop(),u.current&&u.current.getTracks().forEach(e=>e.stop()),E.current&&await E.current.endConversation(),T(e=>({...e,isRecording:!1,isConnected:!1,aiSpeaking:!1,aiListening:!1})),setTimeout(()=>{window.location.href="/interviews/analysis/".concat(A)},2e3)}catch(e){console.error("Error ending interview:",e),F("Error ending interview. Please try again.")}},[_.isRecording,A]),J=(0,a.useCallback)(()=>{if(u.current){let e=u.current.getAudioTracks()[0];e&&(e.enabled=_.isMuted,T(e=>({...e,isMuted:!e.isMuted})))}},[_.isMuted]),$=(0,a.useCallback)(()=>{if(u.current){let e=u.current.getVideoTracks()[0];e&&(e.enabled=!_.isVideoEnabled,T(e=>({...e,isVideoEnabled:!e.isVideoEnabled})))}},[_.isVideoEnabled]);return((0,a.useEffect)(()=>()=>{E.current&&E.current.endConversation().catch(console.error)},[]),(0,a.useEffect)(()=>(P(),()=>{u.current&&u.current.getTracks().forEach(e=>e.stop())}),[P]),B)?(0,i.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center text-white",children:[(0,i.jsx)(x.A,{className:"h-8 w-8 animate-spin mx-auto mb-4"}),(0,i.jsx)("p",{children:"Initializing interview session..."})]})}):(0,i.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,i.jsx)("div",{className:"bg-gray-900 border-b border-gray-800 p-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(v.A,{className:"h-6 w-6 text-blue-400"}),(0,i.jsx)("span",{className:"font-semibold",children:"AI Interview"})]}),(0,i.jsx)(d.Separator,{orientation:"vertical",className:"h-6"}),(0,i.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-300",children:[(0,i.jsx)("span",{children:I}),(0,i.jsx)("span",{children:"•"}),(0,i.jsx)("span",{children:L}),(0,i.jsx)("span",{children:"•"}),(0,i.jsx)("span",{children:R})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(f.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"font-mono",children:(e=>{let t=Math.floor(e/60);return"".concat(t.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(_.duration)})]}),_.isRecording&&(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(b.A,{className:"h-3 w-3 fill-red-500 text-red-500 animate-pulse"}),(0,i.jsx)("span",{className:"text-red-400 text-sm",children:"RECORDING"})]})]})]})}),(0,i.jsxs)("div",{className:"flex h-[calc(100vh-80px)]",children:[(0,i.jsx)("div",{className:"flex-1 relative",children:(0,i.jsxs)("div",{className:"absolute inset-0",children:[(0,i.jsx)("video",{ref:t,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,i.jsx)("div",{className:"absolute top-4 left-4 w-48 h-36 bg-gray-800 rounded-lg border-2 border-blue-400 overflow-hidden",children:(0,i.jsxs)("div",{className:"relative w-full h-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center",children:[(0,i.jsxs)("div",{className:"relative ".concat(_.aiSpeaking?"animate-pulse":""),children:[(0,i.jsx)("div",{className:"w-16 h-16 bg-white rounded-full flex items-center justify-center",children:(0,i.jsx)(v.A,{className:"h-8 w-8 text-blue-600"})}),_.aiSpeaking&&(0,i.jsx)("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:(0,i.jsx)(w.A,{className:"h-4 w-4 text-white animate-bounce"})}),_.aiListening&&(0,i.jsx)("div",{className:"absolute -top-2 -right-2",children:(0,i.jsx)("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"})})]}),(0,i.jsx)("div",{className:"absolute bottom-2 left-2 right-2",children:(0,i.jsx)("div",{className:"text-xs text-white text-center",children:_.aiSpeaking?"Speaking...":_.aiListening?"Listening...":"AI Interviewer"})})]})}),z&&_.aiSpeaking&&(0,i.jsx)("div",{className:"absolute bottom-20 left-4 right-4",children:(0,i.jsx)(o.Zp,{className:"bg-gray-900/90 border-blue-400",children:(0,i.jsx)(o.Wu,{className:"p-4",children:(0,i.jsx)("p",{className:"text-white text-sm",children:z})})})}),(0,i.jsx)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2",children:(0,i.jsxs)("div",{className:"flex items-center gap-3 bg-gray-900/80 rounded-full p-3",children:[(0,i.jsx)(r.$,{variant:_.isMuted?"destructive":"secondary",size:"sm",onClick:J,className:"rounded-full p-3",children:_.isMuted?(0,i.jsx)(y.A,{className:"h-4 w-4"}):(0,i.jsx)(j.A,{className:"h-4 w-4"})}),(0,i.jsx)(r.$,{variant:_.isVideoEnabled?"secondary":"destructive",size:"sm",onClick:$,className:"rounded-full p-3",children:_.isVideoEnabled?(0,i.jsx)(S.A,{className:"h-4 w-4"}):(0,i.jsx)(N.A,{className:"h-4 w-4"})}),_.isRecording?(0,i.jsxs)(r.$,{onClick:U,variant:"destructive",className:"rounded-full px-6",children:[(0,i.jsx)(k.A,{className:"h-4 w-4 mr-2"}),"End Interview"]}):(0,i.jsx)(r.$,{onClick:W,className:"bg-green-600 hover:bg-green-700 rounded-full px-6",children:"Start Interview"})]})})]})}),(0,i.jsxs)("div",{className:"w-96 bg-gray-900 border-l border-gray-800 flex flex-col",children:[(0,i.jsxs)("div",{className:"p-4 border-b border-gray-800",children:[(0,i.jsxs)("h3",{className:"font-semibold flex items-center gap-2",children:[(0,i.jsx)(C.A,{className:"h-5 w-5 text-blue-400"}),"Live Transcript"]}),(0,i.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Real-time conversation transcription"})]}),(0,i.jsx)(l.F,{className:"flex-1 p-4",children:(0,i.jsxs)("div",{className:"space-y-4",children:[M.map(e=>(0,i.jsxs)("div",{className:"p-3 rounded-lg ".concat("ai"===e.speaker?"bg-blue-900/50 border-l-4 border-blue-400":"bg-gray-800 border-l-4 border-green-400"),children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,i.jsx)(c.E,{variant:"ai"===e.speaker?"default":"secondary",className:"text-xs",children:"ai"===e.speaker?"AI Interviewer":"You"}),(0,i.jsx)("span",{className:"text-xs text-gray-400",children:e.timestamp.toLocaleTimeString()})]}),(0,i.jsx)("p",{className:"text-sm text-white",children:e.text}),e.confidence&&(0,i.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:["Confidence: ",Math.round(100*e.confidence),"%"]})]},e.id)),0===M.length&&!_.isRecording&&(0,i.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,i.jsx)(C.A,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,i.jsx)("p",{children:"Start the interview to see live transcription"})]})]})}),(0,i.jsxs)("div",{className:"p-4 border-t border-gray-800",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,i.jsx)("span",{className:"text-gray-400",children:"Transcript entries:"}),(0,i.jsx)("span",{className:"text-white",children:M.length})]}),_.isRecording&&(0,i.jsxs)("div",{className:"flex items-center gap-2 mt-2 text-xs text-green-400",children:[(0,i.jsx)(b.A,{className:"h-2 w-2 fill-current animate-pulse"}),(0,i.jsx)("span",{children:"Recording and transcribing..."})]})]})]})]}),O&&(0,i.jsx)(h.Fc,{className:"absolute top-20 left-4 right-4 mx-auto max-w-md",variant:"destructive",children:(0,i.jsx)(h.TN,{children:O})})]})}function A(){return(0,i.jsx)(a.Suspense,{fallback:(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:"Loading interview..."}),children:(0,i.jsx)(E,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4121,2076,7358],()=>t(68612)),_N_E=e.O()}]);